<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì…</title>

    <link rel="stylesheet" href="/css/member/signup.css">
</head>
<body>

	<header th:replace="~{common/topbar}"></header>
	
    <div class="container">
        <div class="image-container">
            <img src="/image/member/signup1.png" class="background-shape">
            <img src="/image/member/signup2.png" class="character">
            <div class="text-overlay">
                <p>Start testing in minutes!</p>
                <div class="login-text">
                    ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="/member/signin">ë¡œê·¸ì¸</a>
                </div>
            </div>
        </div>

        <div class="signUp-box">
        
        	<div th:if="${errorMessage}" class="error-message">
			    <script>
			        alert("[[${errorMessage}]]");
			    </script>
			</div>
        	
            <form th:action="@{/member/signup}" method="post">
                <!-- ì•„ì´ë”” ì…ë ¥ -->
                <div class="input-box">
				    <input type="text" id="memberId" name="memberId" placeholder=" " required>
				    <label for="memberId">ì•„ì´ë””</label>
				</div>
	
                <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
                <div class="input-box">
				    <input type="password" id="memberPwd" name="memberPwd" placeholder=" " required>
				    <label for="memberPwd">ë¹„ë°€ë²ˆí˜¸</label>
				    <p id="pwdStrength" style="font-size: 12px; margin-top: 5px;"></p> <!-- âœ… ì¶”ê°€ -->
				</div>

                <!-- ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
                <div class="input-box">
                    <input type="password" id="confirmPassword" name="confirmPassword" placeholder=" " required>
                    <label for="confirmPassword">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <p id="pwdCheck" style="font-size: 12px; margin-top: 5px;"></p>
                </div>

                <!-- ë‹‰ë„¤ì„ ì…ë ¥ -->
                <div class="input-box">
                    <input type="text" id="memberNickname" name="memberNickname" placeholder=" " required>
                    <label for="memberNickname">ë‹‰ë„¤ì„</label>
                </div>

                <!-- ì „í™”ë²ˆí˜¸ ì…ë ¥ -->
                <div class="input-box">
                    <input type="text" id="memberPhone" name="memberPhone" pattern="[0-9]{10,11}" placeholder=" " required />
                    <label>ì „í™”ë²ˆí˜¸</label>
                </div>

                <!-- ì´ë©”ì¼ ì…ë ¥ -->
                <div class="input-box" >
                	<div style="display:flex;">
	                    <input type="text" id="emailId" name="emailId" placeholder="ì´ë©”ì¼ ì•„ì´ë””" required>
	                    <p style= "font-size:14px;">@</p>
	                    <select id="emailDomainSelect" name="emailDomain">
	                        <option value="gmail.com">gmail.com</option>
	                        <option value="naver.com">naver.com</option>
	                        <option value="daum.net">daum.net</option>
	                        <option value="nate.com">nate.com</option>
	                        <option value="custom">ì§ì ‘ ì…ë ¥</option>
	                    </select>
	                    <input type="text" id="customEmailDomain" name="customEmailDomain" placeholder="ì§ì ‘ ì…ë ¥" style="display:none; margin-left: 5px;">
	            	</div>
                </div>

                <!-- ìƒë…„ì›”ì¼ ì…ë ¥ -->
                <div class="input-box">
                    <input type="date" id="memberBirthDate" name="memberBirthDate" required>
                    <input type="hidden" id="memberBirth" name="memberBirth"> 
                    <label for="memberBirth">ìƒë…„ì›”ì¼</label>
                </div>

                <!-- ì„±ë³„ ì„ íƒ -->
                <div class="gender-checkbox-group">
                    <label class="gender-checkbox">
                        <input type="radio" name="memberGender" value="M" required>
                        <span class="gender-label">ë‚¨ì„±</span>
                    </label>
                    <label class="gender-checkbox">
                        <input type="radio" name="memberGender" value="F" required>
                        <span class="gender-label">ì—¬ì„±</span>
                    </label>
                </div>

                <button type="submit" id="submitBtn" class="btn">íšŒì›ê°€ì…</button>
            </form>
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
    	const memberPwdInput = document.getElementById("memberPwd");
	    const confirmPwdInput = document.getElementById("confirmPassword");
	    const pwdCheck = document.getElementById("pwdCheck");
	    const signupBtn = document.getElementById("submitBtn");
	    const strengthMsg = document.getElementById("pwdStrength");
	
	    const memberIdInput = document.getElementById("memberId");
	    const idCheckMsg = document.getElementById("idCheck");
	
	    const emailDomainSelect = document.getElementById('emailDomainSelect');
	    const customDomainInput = document.getElementById('customEmailDomain');
	
	    // âœ… ë¹„ë°€ë²ˆí˜¸ ê°•ë„ íŒë‹¨ í•¨ìˆ˜
	    function checkPasswordStrength(pwd) {
	      if (pwd.length < 6) {
	        return { text: "ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤.", color: "gray" };
	      }
	      const hasNum = /\d/.test(pwd);
	      const hasEng = /[a-zA-Z]/.test(pwd);
	      const hasSpecial = /[!@#$%^&*()_+{}\[\]:;<>,.?~\\/-]/.test(pwd);
	
	      if (hasNum && hasEng && hasSpecial && pwd.length >= 10) {
	        return { text: "ê°•í•¨ ğŸ’ª", color: "green" };
	      } else if ((hasEng && hasNum) || (hasEng && hasSpecial) || (hasNum && hasSpecial)) {
	        return { text: "ë³´í†µ ğŸ‘", color: "orange" };
	      } else {
	        return { text: "ì•½í•¨ ğŸ˜¢", color: "red" };
	      }
	    }
	
	    // âœ… ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì‹œ ê°•ë„ ì²´í¬
	    memberPwdInput.addEventListener("input", function () {
	      const pwd = memberPwdInput.value;
	      const strength = checkPasswordStrength(pwd);
	      strengthMsg.textContent = strength.text;
	      strengthMsg.style.color = strength.color;
	      checkPasswordMatch();
	    });
	
	    // âœ… ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì¼ì¹˜ ì—¬ë¶€ ì²´í¬
	    function checkPasswordMatch() {
	      if (memberPwdInput.value !== confirmPwdInput.value) {
	        pwdCheck.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
	        pwdCheck.style.color = "red";
	        signupBtn.disabled = true;
	      } else {
	        pwdCheck.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.";
	        pwdCheck.style.color = "green";
	        signupBtn.disabled = false;
	      }
	    }
	
	    confirmPwdInput.addEventListener("input", checkPasswordMatch);
	    // âœ… ì´ë©”ì¼ ë„ë©”ì¸ ì²˜ë¦¬
	    emailDomainSelect.addEventListener('change', function () {
	      if (this.value === 'custom') {
	        customDomainInput.style.display = 'inline-block';
	        customDomainInput.required = true;
	      } else {
	        customDomainInput.style.display = 'none';
	        customDomainInput.required = false;
	        customDomainInput.value = '';
	      }
	    });
	
	    // âœ… ìƒë…„ì›”ì¼ ë³€í™˜ (YYYYMMDDë¡œ íˆë“ ì— ì €ì¥)
	    document.querySelector('form').addEventListener('submit', function (event) {
	      const birthInput = document.getElementById('memberBirthDate');
	      const hiddenBirthInput = document.getElementById('memberBirth');
	
	      if (!birthInput.value) {
	        event.preventDefault();
	        alert("ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
	        return;
	      }
	
	      const birthDate = new Date(birthInput.value);
	      const year = birthDate.getFullYear();
	      const month = String(birthDate.getMonth() + 1).padStart(2, '0');
	      const day = String(birthDate.getDate()).padStart(2, '0');
	
	      hiddenBirthInput.value = `${year}${month}${day}`;
	    });
	  });
    
    const phoneInput = document.getElementById("memberPhone");
    phoneInput.addEventListener("input", function () {
      let val = this.value.replace(/\D/g, ""); // ìˆ«ìë§Œ ë‚¨ê¹€

      if (val.length < 4) {
        this.value = val;
      } else if (val.length < 7) {
        this.value = val.replace(/(\d{3})(\d+)/, "$1-$2");
      } else if (val.length <= 11) {
        this.value = val.replace(/(\d{3})(\d{4})(\d+)/, "$1-$2-$3");
      } else {
        this.value = val.substring(0, 11).replace(/(\d{3})(\d{4})(\d+)/, "$1-$2-$3");
      }
    });

    // âœ… í¼ ì œì¶œ ì‹œ í•˜ì´í”ˆ ì œê±°í•˜ê³  ì„œë²„ë¡œ ì „ì†¡
    document.querySelector("form").addEventListener("submit", function () {
      const cleaned = phoneInput.value.replace(/-/g, ""); // í•˜ì´í”ˆ ì œê±°
      phoneInput.value = cleaned;
    });
</script>

</body>
</html>
